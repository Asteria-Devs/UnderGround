<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pac-Man</title>
  <style>
    body {
      background: black;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: yellow;
      font-family: sans-serif;
    }
    #stats {
      margin: 10px;
    }
    #game {
      display: grid;
      grid-template-columns: repeat(40, 20px);
      grid-template-rows: repeat(30, 20px);
    }
    .wall {
      background: blue;
    }
    .pacman {
      background: yellow;
      border-radius: 50%;
    }
    .dot {
      background: white;
      border-radius: 50%;
      width: 6px;
      height: 6px;
      margin: auto;
    }
    .cell {
      width: 20px;
      height: 20px;
      box-sizing: border-box;
    }
    .ghost {
      border-radius: 50%;
    }
    .red { background: red; }
    .pink { background: pink; }
    .cyan { background: cyan; }
    .orange { background: orange; }
  </style>
</head>
<body>
  <div id="stats">
    Score: <span id="score">0</span> |
    Lives: <span id="lives">3</span> |
    Level: <span id="level">1</span>
  </div>
  <div id="game"></div>
  <script>
    const game = document.getElementById('game');
    const scoreDisplay = document.getElementById('score');
    const livesDisplay = document.getElementById('lives');
    const levelDisplay = document.getElementById('level');
    const width = 40;
    const height = 30;
    const layout = new Array(width * height).fill(0);

    // Randomly generate a complex map (simple pattern for now)
    for (let i = 0; i < layout.length; i++) {
      const row = Math.floor(i / width);
      const col = i % width;
      if (row === 0 || col === 0 || row === height - 1 || col === width - 1 || (row % 4 === 0 && col % 3 === 0)) {
        layout[i] = 1; // wall
      } else {
        layout[i] = 0; // dot
      }
    }

    let pacmanIndex = width + 1;
    let ghosts = [];
    let score = 0;
    let lives = 3;
    let level = 1;

    function createBoard() {
      game.innerHTML = '';
      layout.forEach((type, i) => {
        const cell = document.createElement('div');
        cell.classList.add('cell');
        if (type === 1) cell.classList.add('wall');
        else cell.innerHTML = '<div class="dot"></div>';
        game.appendChild(cell);
      });
      document.querySelectorAll('.cell')[pacmanIndex].classList.add('pacman');
    }

    function drawGhosts() {
      ghosts.forEach(g => {
        if (g.index >= 0 && g.index < width * height) {
          const cell = document.querySelectorAll('.cell')[g.index];
          if (cell) cell.classList.add('ghost', g.class);
        }
      });
    }

    function removeGhosts() {
      document.querySelectorAll('.ghost').forEach(cell => {
        cell.className = 'cell';
      });
    }

    function movePacman(e) {
      const cells = document.querySelectorAll('.cell');
      cells[pacmanIndex].classList.remove('pacman');
      let next = pacmanIndex;
      if (e.key === 'ArrowLeft' && pacmanIndex % width !== 0 && !cells[pacmanIndex - 1].classList.contains('wall')) next--;
      else if (e.key === 'ArrowRight' && pacmanIndex % width < width - 1 && !cells[pacmanIndex + 1].classList.contains('wall')) next++;
      else if (e.key === 'ArrowUp' && pacmanIndex - width >= 0 && !cells[pacmanIndex - width].classList.contains('wall')) next -= width;
      else if (e.key === 'ArrowDown' && pacmanIndex + width < width * height && !cells[pacmanIndex + width].classList.contains('wall')) next += width;

      pacmanIndex = next;
      const dot = cells[pacmanIndex].querySelector('.dot');
      if (dot) {
        dot.remove();
        score += 10;
        scoreDisplay.textContent = score;
      }
      if (!document.querySelector('.dot')) nextLevel();
      if (ghosts.some(g => g.index === pacmanIndex)) loseLife();
      cells[pacmanIndex].classList.add('pacman');
    }

    function nextLevel() {
      level++;
      levelDisplay.textContent = level;
      pacmanIndex = width + 1;
      createBoard();
      setupGhosts();
    }

    function loseLife() {
      lives--;
      livesDisplay.textContent = lives;
      if (lives === 0) {
        alert("Game Over");
        lives = 3;
        score = 0;
        level = 1;
        scoreDisplay.textContent = score;
        levelDisplay.textContent = level;
      }
      pacmanIndex = width + 1;
      createBoard();
      setupGhosts();
    }

    function setupGhosts() {
      ghosts = [
        { index: width * 2 + 2, class: 'red' },
        { index: width * 2 + 37, class: 'pink' },
        { index: width * 27 + 2, class: 'cyan' },
        { index: width * 27 + 37, class: 'orange' }
      ];
    }

    function moveGhosts() {
      const cells = document.querySelectorAll('.cell');
      ghosts.forEach(ghost => {
        const directions = [-1, 1, -width, width];
        const next = ghost.index + directions[Math.floor(Math.random() * 4)];
        if (next >= 0 && next < width * height && !cells[next].classList.contains('wall')) {
          ghost.index = next;
        }
      });
      if (ghosts.some(g => g.index === pacmanIndex)) loseLife();
    }

    createBoard();
    setupGhosts();
    document.addEventListener('keydown', movePacman);
    setInterval(() => {
      removeGhosts();
      moveGhosts();
      drawGhosts();
    }, 400);
  </script>
</body>
</html>
